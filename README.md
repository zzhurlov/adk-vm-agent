# VM Agent - ИИ агент для управления виртуальными машинами

ИИ агент на основе Google ADK (Agent Development Kit) и модели Gemini для управления виртуальными машинами через естественный язык. Агент позволяет создавать, запускать, останавливать, удалять и получать информацию о виртуальных машинах, используя текстовые команды.

## Описание

VM Agent - это интеллектуальный помощник для управления виртуальными машинами, который использует возможности больших языковых моделей (LLM) для понимания естественного языка и выполнения операций с ВМ. Агент работает через Google ADK и использует модель Gemini 2.5 Flash для обработки запросов.

### Основные возможности

- **Создание виртуальных машин** - создание ВМ с указанием конфигурации (память, CPU, диск, сеть)
- **Управление состоянием ВМ** - запуск и остановка виртуальных машин
- **Просмотр списка ВМ** - получение списка всех доступных виртуальных машин
- **Удаление ВМ** - удаление виртуальных машин по имени
- **Естественный язык** - взаимодействие с агентом через текстовые команды на естественном языке

## Требования

### Системные требования

- **Go 1.25.5** или выше
- **Linux** (тестировалось на Linux 6.17.0)
- **Интернет-соединение** (для работы с API Gemini)

### API ключ

Для работы агента необходим API ключ Google Gemini. Получить ключ можно на [Google AI Studio](https://makersuite.google.com/app/apikey).

## Установка

1. **Клонируйте репозиторий** (если применимо):
```bash
git clone <repository-url>
cd test
```

2. **Установите зависимости**:
```bash
go mod download
```

3. **Создайте файл `.env`** в корне проекта:
```bash
touch .env
```

4. **Добавьте API ключ в `.env`**:
```env
GOOGLE_API_KEY=your_api_key_here
```

## Настройка

### Переменные окружения

Создайте файл `.env` в корне проекта со следующим содержимым:

```env
GOOGLE_API_KEY=your_google_gemini_api_key
```

Альтернативно, вы можете установить переменную окружения напрямую:

```bash
export GOOGLE_API_KEY=your_google_gemini_api_key
```

## Использование

### Запуск агента

```bash
go run my_agent/agent.go
```

Или скомпилируйте и запустите:

```bash
go build -o vm-agent my_agent/agent.go
./vm-agent
```

### Примеры команд

После запуска агента вы можете взаимодействовать с ним через командную строку, используя естественный язык:

```
Создай виртуальную машину с именем "test-vm", 2 ГБ памяти и 2 CPU
```

```
Покажи список всех виртуальных машин
```

```
Запусти виртуальную машину "test-vm"
```

```
Останови виртуальную машину "test-vm"
```

```
Удали виртуальную машину "test-vm"
```

## Архитектура

### Структура проекта

```
test/
├── my_agent/
│   └── agent.go          # Основной файл агента
├── vm/
│   ├── manager.go     # Интерфейс и mock-реализация менеджера ВМ
│   └── tools.go      # Инструменты (tools) для работы с ВМ
├── go.mod               # Зависимости проекта
├── go.sum              # Checksums зависимостей
└── README.md           # Документация
```

### Компоненты

#### `my_agent/agent.go`
- Инициализация модели Gemini
- Создание и настройка ИИ агента
- Загрузка переменных окружения
- Запуск launcher для взаимодействия с агентом

#### `vm/vm_manager.go`
- Интерфейс `VMManagerInterface` для управления ВМ
- Mock-реализация `MockVMManager` (хранит данные в памяти)
- Структуры конфигурации ВМ и состояний

#### `vm/vm_tools.go`
- Набор инструментов (tools) для агента:
  - `create_vm` - создание виртуальной машины
  - `start_vm` - запуск ВМ
  - `stop_vm` - остановка ВМ
  - `list_vms` - список всех ВМ
  - `delete_vm` - удаление ВМ

### Mock-режим

По умолчанию агент использует mock-реализацию менеджера ВМ (`MockVMManager`), которая:
- Хранит все данные в памяти
- Не создает реальные виртуальные машины
- Не требует дополнительных зависимостей (libvirt и т.д.)
- Подходит для тестирования и разработки

Все виртуальные машины хранятся только в памяти процесса и исчезают при завершении программы.

## API инструментов

### create_vm
Создает новую виртуальную машину.

**Параметры:**
- `name` (string) - имя виртуальной машины
- `memory` (uint64) - объем памяти в МБ
- `vcpus` (uint) - количество виртуальных CPU
- `disk_path` (string, опционально) - путь к диску
- `disk_size` (uint64, опционально) - размер диска в ГБ
- `iso_image` (string, опционально) - путь к ISO образу
- `network` (string, опционально) - тип сети

### start_vm
Запускает виртуальную машину.

**Параметры:**
- `name` (string) - имя виртуальной машины

### stop_vm
Останавливает виртуальную машину.

**Параметры:**
- `name` (string) - имя виртуальной машины

### list_vms
Возвращает список всех виртуальных машин.

**Параметры:** отсутствуют

### delete_vm
Удаляет виртуальную машину.

**Параметры:**
- `name` (string) - имя виртуальной машины

## Зависимости

Основные зависимости проекта:

- `google.golang.org/adk` - Google Agent Development Kit
- `google.golang.org/genai` - Google Generative AI SDK
- `github.com/joho/godotenv` - Загрузка переменных окружения из .env файла

Полный список зависимостей см. в `go.mod`.

## Разработка

### Добавление новых инструментов

Для добавления новых инструментов управления ВМ:

1. Добавьте структуры аргументов и результатов в `vm/vm_tools.go`
2. Создайте новый инструмент с помощью `functiontool.New()`
3. Добавьте инструмент в массив `tools` в функции `NewVMTools()`

### Реализация реального менеджера ВМ

Для работы с реальными виртуальными машинами (например, через libvirt):

1. Создайте новую реализацию интерфейса `VMManagerInterface`
2. Замените `NewMockVMManager()` на вашу реализацию в `agent.go`

## Ограничения

- В текущей версии используется mock-реализация, которая не создает реальные ВМ
- Все данные хранятся в памяти и теряются при завершении программы
- Требуется активное интернет-соединение для работы с API Gemini